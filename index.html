<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aide Devoir</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#f0f0f0; }
  .hidden { display: none; }
  .container { padding:20px; max-width:900px; margin:auto; }
  button { margin:5px; padding:10px 20px; cursor:pointer; }
  input[type="text"], input[type="number"] { padding:5px; margin-right:5px; width:70%; }
  .card, .task { background:#fff; padding:10px; margin:5px 0; border-radius:5px; display:flex; justify-content:space-between; align-items:center; }
  .task-list { list-style:none; padding:0; }
  .flashcard { cursor:pointer; padding:20px; border-radius:10px; text-align:center; background:#fff; margin:10px 0; perspective:1000px; }
  .flashcard-inner { transition:0.6s; transform-style:preserve-3d; position:relative; }
  .flashcard.flipped .flashcard-inner { transform:rotateY(180deg); }
  .flashcard-front, .flashcard-back { backface-visibility:hidden; position:absolute; width:100%; height:100%; top:0; left:0; display:flex; justify-content:center; align-items:center; font-size:18px; }
  .flashcard-back { transform:rotateY(180deg); background:#d0ffd0; }
  .quiz-question { margin:10px 0; }
  .correct { background-color:#a0ffa0; }
  .wrong { background-color:#ffa0a0; }
</style>
</head>
<body>
<div class="container" id="mainMenu">
  <h1>Aide Devoir</h1>
  <button onclick="showInterface('quiz')">Quiz</button>
  <button onclick="showInterface('flashcard')">Flashcards</button>
  <button onclick="showInterface('pomodoro')">Minuteur Pomodoro</button>
  <button onclick="showInterface('todo')">Liste de Tâches</button>
</div>

<!-- Quiz Interface -->
<div class="container hidden" id="quizInterface">
  <button onclick="backToMain()">← Retour</button>
  <h2>Quiz</h2>
  <h3>Choisir une matière</h3>
  <div id="quizSubjects"></div>
  <button onclick="createQuiz()">Créer un nouveau quiz</button>
  <div id="quizList"></div>
  <div id="quizPlay" class="hidden">
    <h3 id="quizTitle"></h3>
    <div id="quizQuestion"></div>
    <div id="quizChoices"></div>
    <button id="nextQuestionBtn" onclick="nextQuestion()">Suivant</button>
    <div id="quizScore" class="hidden"></div>
    <button id="retryBtn" class="hidden" onclick="retryQuiz()">Recommencer le quiz</button>
    <button id="retryErrorBtn" class="hidden" onclick="retryErrors()">Recommencer seulement les erreurs</button>
  </div>
</div>

<!-- Flashcard Interface -->
<div class="container hidden" id="flashcardInterface">
  <button onclick="backToMain()">← Retour</button>
  <h2>Flashcards</h2>
  <h3>Choisir une matière</h3>
  <div id="flashcardSubjects"></div>
  <button onclick="createFlashcard()">Créer un nouveau groupe de flashcards</button>
  <div id="flashcardList"></div>
  <div id="flashcardPlay" class="hidden">
    <h3 id="flashcardTitle"></h3>
    <div id="flashcardContainer"></div>
    <div id="flashcardScoreDiv" class="hidden">
      <h3>Score: <span id="flashcardScore"></span></h3>
      <button onclick="restartFlashcards()">Recommencer</button>
      <button onclick="restartFlashcardsErrors()">Recommencer les erreurs</button>
    </div>
  </div>
</div>

<!-- Pomodoro Timer -->
<div class="container hidden" id="pomodoroInterface">
  <button onclick="backToMain()">← Retour</button>
  <h2>Minuteur Pomodoro</h2>
  <input type="number" id="pomodoroMinutes" placeholder="Minutes" min="1">
  <button onclick="startPomodoro()">Start</button>
  <button onclick="pausePomodoro()">Pause</button>
  <h3 id="pomodoroDisplay">00:00</h3>
</div>

<!-- Todo List -->
<div class="container hidden" id="todoInterface">
  <button onclick="backToMain()">← Retour</button>
  <h2>Liste de Tâches</h2>
  <input type="text" id="newTaskInput" placeholder="Nouvelle tâche">
  <button onclick="addTask()">Ajouter</button>
  <ul id="taskList" class="task-list"></ul>
</div>

<script>
/* ---------------- Interface ---------------- */
let currentInterface='mainMenu';
function showInterface(name){
  document.getElementById(currentInterface).classList.add('hidden');
  document.getElementById(name+'Interface').classList.remove('hidden');
  currentInterface=name;
}
function backToMain(){
  saveAll();
  document.getElementById(currentInterface).classList.add('hidden');
  document.getElementById('mainMenu').classList.remove('hidden');
  currentInterface='mainMenu';
}

/* ---------------- LocalStorage ---------------- */
function saveAll(){
  localStorage.setItem('quizzes',JSON.stringify(quizzes));
  localStorage.setItem('flashcardsGroups',JSON.stringify(flashcardsGroups));
  localStorage.setItem('tasks',JSON.stringify(Array.from(document.querySelectorAll('#taskList li')).map(li=>li.firstChild.textContent)));
}
function loadAll(){
  quizzes=JSON.parse(localStorage.getItem('quizzes')||'[]');
  flashcardsGroups=JSON.parse(localStorage.getItem('flashcardsGroups')||'[]');
  let tasks=JSON.parse(localStorage.getItem('tasks')||'[]');
  tasks.forEach(t=>{
    const li=document.createElement('li'); li.className='task';
    li.textContent=t;
    const xBtn=document.createElement('button'); xBtn.textContent='X'; xBtn.onclick=()=>li.remove();
    li.appendChild(xBtn); document.getElementById('taskList').appendChild(li);
  });
}
window.onload=()=>{
  loadAll(); renderQuizSubjects(); renderFlashcardSubjects();
};

/* ---------------- Pomodoro ---------------- */
let pomodoroTimer; let pomodoroTime=0;
function startPomodoro(){
  clearInterval(pomodoroTimer);
  let minutes=parseInt(document.getElementById('pomodoroMinutes').value)||25;
  pomodoroTime=minutes*60;
  pomodoroTimer=setInterval(()=>{
    let m=Math.floor(pomodoroTime/60), s=pomodoroTime%60;
    document.getElementById('pomodoroDisplay').textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    if(pomodoroTime<=0) clearInterval(pomodoroTimer);
    pomodoroTime--;
  },1000);
}
function pausePomodoro(){ clearInterval(pomodoroTimer); }

/* ---------------- Todo List ---------------- */
function addTask(){
  let input=document.getElementById('newTaskInput');
  if(input.value.trim()==='') return;
  const li=document.createElement('li'); li.className='task';
  li.textContent=input.value;
  const xBtn=document.createElement('button'); xBtn.textContent='X'; xBtn.onclick=()=>li.remove();
  li.appendChild(xBtn);
  document.getElementById('taskList').appendChild(li);
  input.value='';
  saveAll();
}

/* ---------------- Flashcards ---------------- */
let flashcardsGroups=[], currentFlashcardGroup=null, currentFlashcardIndex=0, flashcardScore=0, flashcardErrors=[];
function renderFlashcardSubjects(){
  const subjects = [...new Set(flashcardsGroups.map(g=>g.matiere))];
  const container = document.getElementById('flashcardSubjects');
  container.innerHTML='';
  subjects.forEach(s=>{
    const btn=document.createElement('button'); btn.textContent=s;
    btn.onclick=()=>showFlashcardsBySubject(s);
    container.appendChild(btn);
  });
}
function showFlashcardsBySubject(subject){
  const list = document.getElementById('flashcardList'); list.innerHTML='';
  flashcardsGroups.filter(g=>g.matiere===subject).forEach((g,i)=>{
    const div=document.createElement('div'); div.textContent=g.title;
    const playBtn=document.createElement('button'); playBtn.textContent='Jouer';
    playBtn.onclick=()=>playFlashcards(g);
    div.appendChild(playBtn); list.appendChild(div);
  });
}
function createFlashcard(){
  let matiere=prompt('Nom de la matière:'); if(!matiere) return;
  let title=prompt('Titre du groupe de flashcards:'); if(!title) return;
  let cards=[]; let addMore=true;
  while(addMore){
    let question=prompt('Question:'); let answer=prompt('Réponse:');
    if(question&&answer) cards.push({question,answer});
    addMore=confirm('Ajouter une autre carte?');
  }
  flashcardsGroups.push({matiere,title,cards});
  saveAll(); renderFlashcardSubjects();
}
function playFlashcards(group){
  currentFlashcardGroup=group; currentFlashcardIndex=0; flashcardScore=0; flashcardErrors=[];
  document.getElementById('flashcardList').classList.add('hidden'); document.getElementById('flashcardPlay').classList.remove('hidden');
  document.getElementById('flashcardScoreDiv').classList.add('hidden');
  showFlashcard();
}
function showFlashcard(){
  const container=document.getElementById('flashcardContainer'); container.innerHTML='';
  if(currentFlashcardIndex>=currentFlashcardGroup.cards.length){
    document.getElementById('flashcardScore').textContent=flashcardScore;
    document.getElementById('flashcardScoreDiv').classList.remove('hidden'); return;
  }
  let card=currentFlashcardGroup.cards[currentFlashcardIndex];
  let div=document.createElement('div'); div.className='flashcard';
  let inner=document.createElement('div'); inner.className='flashcard-inner';
  let front=document.createElement('div'); front.className='flashcard-front'; front.textContent=card.question;
  let back=document.createElement('div'); back.className='flashcard-back'; back.textContent=card.answer;
  inner.appendChild(front); inner.appendChild(back); div.appendChild(inner);
  div.onclick=()=>{ div.classList.toggle('flipped'); };
  div.ondblclick=()=>{
    let res=prompt('Bien ou Mal ? (b/m)'); 
    if(res==='b'){flashcardScore++;} else {flashcardErrors.push(card);}
    currentFlashcardIndex++; showFlashcard(); saveAll();
  };
  container.appendChild(div);
}
function restartFlashcards(){ currentFlashcardIndex=0; flashcardScore=0; flashcardErrors=[]; showFlashcard(); }
function restartFlashcardsErrors(){ currentFlashcardGroup.cards=flashcardErrors; currentFlashcardIndex=0; flashcardScore=0; flashcardErrors=[]; showFlashcard(); }

/* ---------------- Quiz ---------------- */
let quizzes=[], currentQuiz=null, currentQIndex=0, quizScore=0, quizErrors=[];
function renderQuizSubjects(){
  const subjects = [...new Set(quizzes.map(q=>q.matiere))];
  const container=document.getElementById('quizSubjects'); container.innerHTML='';
  subjects.forEach(s=>{
    const btn=document.createElement('button'); btn.textContent=s;
    btn.onclick=()=>showQuizzesBySubject(s); container.appendChild(btn);
  });
}
function showQuizzesBySubject(subject){
  const list=document.getElementById('quizList'); list.innerHTML='';
  quizzes.filter(q=>q.matiere===subject).forEach(q=>{
    const div=document.createElement('div'); div.textContent=q.title;
    const playBtn=document.createElement('button'); playBtn.textContent='Jouer';
    playBtn.onclick=()=>playQuiz(q); div.appendChild(playBtn); list.appendChild(div);
  });
}
function createQuiz(){
  let matiere=prompt('Nom de la matière:'); if(!matiere) return;
  let title=prompt('Titre du quiz:'); if(!title) return;
  let questions=[]; let addMore=true;
  while(addMore){
    let qText=prompt('Question:'); let numC=parseInt(prompt('Nombre de réponses (2-4):'));
    let choices=[]; for(let i=0;i<numC;i++) choices.push(prompt('Réponse '+(i+1)+':'));
    let correct=parseInt(prompt('Numéro de la bonne réponse (1-'+numC+'):'))-1;
    questions.push({question:qText,choices,correct});
    addMore=confirm('Ajouter une autre question?');
  }
  quizzes.push({matiere,title,questions});
  saveAll(); renderQuizSubjects();
}
function playQuiz(q){
  currentQuiz=q; currentQIndex=0; quizScore=0; quizErrors=[];
  document.getElementById('quizList').classList.add('hidden'); document.getElementById('quizPlay').classList.remove('hidden');
  document.getElementById('quizScore').classList.add('hidden'); document.getElementById('retryBtn').classList.add('hidden'); document.getElementById('retryErrorBtn').classList.add('hidden');
  showQuizQuestion();
}
function showQuizQuestion(){
  let qElem=document.getElementById('quizQuestion'); let cElem=document.getElementById('quizChoices');
  qElem.innerHTML=''; cElem.innerHTML='';
  if(currentQIndex>=currentQuiz.questions.length){
    document.getElementById('quizScore').textContent=quizScore;
    document.getElementById('quizScore').classList.remove('hidden');
    document.getElementById('retryBtn').classList.remove('hidden'); document.getElementById('retryErrorBtn').classList.remove('hidden');
    saveAll(); return;
  }
  let question=currentQuiz.questions[currentQIndex];
  document.getElementById('quizTitle').textContent=currentQuiz.title;
  qElem.textContent=question.question;
  question.choices.forEach((ch,i)=>{
    let btn=document.createElement('button'); btn.textContent=ch;
    btn.onclick=()=>{
      if(i===question.correct){btn.classList.add('correct'); quizScore++;} else {btn.classList.add('wrong'); quizErrors.push(question);}
      setTimeout(()=>{ currentQIndex++; showQuizQuestion(); saveAll(); },500);
    };
    cElem.appendChild(btn);
  });
}
function nextQuestion(){ currentQIndex++; showQuizQuestion(); }
function retryQuiz(){ currentQIndex=0; quizScore=0; quizErrors=[]; showQuizQuestion(); }
function retryErrors(){ currentQuiz.questions=quizErrors; currentQIndex=0; quizScore=0; quizErrors=[]; showQuizQuestion(); }
</script>
</body>
</html>
